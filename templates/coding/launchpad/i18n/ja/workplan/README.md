# 計画管理

> **このファイルは計画管理の信頼できる情報源です。** AIエージェントは計画の作成、移動、変更時にこれらの指示に従ってください。

## 設定

**Issueトラッカー：** なし
<!-- オプション：GitHub | GitLab | なし -->
<!-- 有効化：「GitHub」または「GitLab」に変更してリポジトリを設定 -->

**リポジトリ：** `ユーザー名/リポジトリ名`

## ファイル命名規則

```
TYPE-YYYY-MM-DD-NNNN-description.md
```

| セグメント | 説明 | 例 |
|-----------|------|-----|
| `TYPE` | 状態：`BACKLOG`、`CODING`、`DONE`、`DRAFT` | `BACKLOG` |
| `YYYY-MM-DD` | 現在の状態への遷移日 | `2026-01-15` |
| `NNNN` | 内部連番ID、4桁ゼロパディング | `0001` |
| `description` | kebab-caseの短い名前 | `user-auth-setup` |

### 内部ID（`NNNN`）

プロジェクト固有の増分カウンター。次のIDを取得するには：

1. すべてのサブフォルダ（`backlog/`、`coding/`、`done/`）で最大の `NNNN` を検索
2. 1を加算

IDは**永続的**です — 計画の状態や名前が変更されても変わりません。

> **予約済み：** ID `0000` はサンプル/テンプレートファイル用に予約されています。最初の実際の計画は `0001` を使用してください。

### 日付ルール

ファイル名の日付は現在の状態への遷移を反映します：

| 状態 | ファイル名の日付 = |
|------|-------------------|
| BACKLOG | 計画の作成日 |
| CODING | 作業開始日 |
| DONE | 完了日 |

## フォルダ構成

```
workplan/
├── README.md          # このファイル（信頼できる情報源）
├── backlog/           # 未着手の計画
├── coding/            # 進行中の作業
├── done/              # 完了した計画（アーカイブ）
└── draft/             # 下書き、アイデア、決定事項（状態ワークフローなし）
```

## 標準ヘッダー

```markdown
# 計画：説明的なタイトル

**状態：** Backlog | Coding | Done
**Backlog：** 2026-01-15
**Coding：** —
**Done：** —
**ドメイン：** 一般
**Issue：** —
```

**ヘッダールール：**
- 状態はファイル名のプレフィックスと一致すること
- 日付は各遷移が発生した時点を記録（`—` は該当なし）
- Issueトラッカーが「なし」の場合、**Issue** は `—`

## 標準テンプレート

### 必須用語

| 用語 | 使い方 | 例 |
|------|--------|-----|
| **フェーズ** | 主要な実装マイルストーン | フェーズ 1：MVP、フェーズ 2：改善 |
| **ステップ** | 進捗チェックリストの具体的な項目 | `- [ ] SQLマイグレーションを作成` |

### セクション順序

ヘッダー → 進捗 → 目的 → コンテキスト → 実装 → 検証 → リスク

オプションのセクションは空にせず、**省略**します。

### テンプレート

```markdown
# 計画：説明的なタイトル

**状態：** Backlog
**Backlog：** YYYY-MM-DD
**Coding：** —
**Done：** —
**ドメイン：** 一般
**Issue：** —

## 進捗

### フェーズ 1：MVP
- [ ] 具体的で検証可能なステップ
- [ ] 別のステップ

### フェーズ 2：改善 *（該当する場合）*
- [ ] 具体的で検証可能なステップ

## 目的

何を達成したいか、なぜか（1〜3段落）。

## コンテキスト *（任意）*

現状、前提条件。

## 実装

### フェーズ 1：MVP

実装の技術的詳細。

### フェーズ 2：改善 *（任意）*

## 検証 *（任意）*

計画が正しく完了したことを検証する手順。

## リスク *（任意）*

複雑な計画のみ。
```

### ルール

1. **進捗は常にヘッダーの直後**、末尾には置かない
2. ステップはフェーズごとにグループ化（`### フェーズ N：名前`）
3. 各ステップは具体的で検証可能であること（曖昧にしない）
4. 技術的詳細は実装に、概要は進捗に記載
5. 「フェーズ」と「ステップ」のみ使用
6. オプションのセクションは空にせず、省略する

## ワークフロー

### 計画の作成

1. 次の連番ID（`NNNN`）を取得
2. `backlog/BACKLOG-YYYY-MM-DD-NNNN-description.md` にファイルを作成

### 作業開始

1. `backlog/` から `coding/CODING-YYYY-MM-DD-NNNN-description.md` に移動（日付 = 今日、ID変更なし）
2. ヘッダーを更新：`状態：Coding`、`Coding：YYYY-MM-DD`

### 完了

1. `coding/` から `done/DONE-YYYY-MM-DD-NNNN-description.md` に移動（日付 = 今日）
2. ヘッダーを更新：`状態：Done`、`Done：YYYY-MM-DD`

### backlogに戻す

1. `coding/` から `backlog/BACKLOG-YYYY-MM-DD-NNNN-description.md` に移動
2. ヘッダーを更新：`状態：Backlog`

## 相互参照

計画間の参照には永続的な**内部ID**（`NNNN`）を使用します：

```markdown
**依存関係：** 計画 0001、計画 0002

詳細は計画 0003を参照。
```

**ルール：** 完全なファイル名での参照は禁止（遷移ごとに変わるため）。常に内部IDを使用。

## 次のIDを取得

```bash
# すべてのサブフォルダで最大のNNNNを検索
ls workplan/{backlog,coding,done}/ | grep -oP '\d{4}' | sort -n | tail -1
# 結果に1を加算
```

## 下書き（ドラフト）

下書きは `draft/` に `DRAFT-YYYY-MM-DD-description.md` の形式で保存されます。BACKLOG→CODING→DONEのワークフローには従わず、連番IDもありません。アイデアバンクとして機能します：計画の下書き、技術的決定事項、探索的メモ。下書きが十分に成熟したら、`backlog/` に正式な計画として昇格させます。
