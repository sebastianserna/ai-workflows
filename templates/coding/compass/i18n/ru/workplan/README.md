# Управление планами

> **Этот файл является источником истины для управления планами.** ИИ-агенты обязаны следовать этим инструкциям при создании, перемещении или изменении планов.

## Конфигурация

**Трекер задач:** none
<!-- Варианты: GitHub | GitLab | none -->
<!-- Для активации: измените на "GitHub" или "GitLab" и настройте репозиторий -->

**Репозиторий:** `user/repo-name`

## Формат имени файла

Формат зависит от того, настроен ли трекер задач:

**С трекером задач (GitHub / GitLab):**

```
TYPE-YYYY-MM-DD-iNNNN-description.md
```

**Без трекера задач (none):**

```
TYPE-YYYY-MM-DD-description.md
```

| Сегмент | Описание | Пример |
|---------|----------|--------|
| `TYPE` | Статус: `BACKLOG`, `CODING`, `DONE`, `DRAFT` | `BACKLOG` |
| `YYYY-MM-DD` | Дата перехода в текущий статус | `2026-01-15` |
| `iNNNN` | Номер задачи, 4 цифры с ведущими нулями и префиксом `i` (только с трекером) | `i0060` |
| `description` | Краткое название в kebab-case | `user-auth-setup` |

### Идентификатор задачи (`iNNNN`)

Когда трекер задач настроен (GitHub или GitLab), каждый план **должен** иметь соответствующую задачу. Номер задачи становится уникальным идентификатором плана:

- Префикс `i` отличает номер задачи от других числовых сегментов
- Дополняется нулями до 4 цифр: задача #7 → `i0007`, задача #123 → `i0123`
- Идентификатор является **постоянным** — он не меняется при перемещении плана между статусами
- GitHub/GitLab гарантирует атомарную уникальность, исключая риски коллизий в совместных средах

**Когда трекер задач настроен как «none»**, планы не имеют сегмента идентификатора. Имя файла просто `TYPE-YYYY-MM-DD-description.md`.

### Правило даты

Дата в имени файла отражает момент перехода в текущий статус:

| Статус | Дата в имени = |
|--------|----------------|
| BACKLOG | Дата создания плана |
| CODING | Дата начала работы |
| DONE | Дата завершения |

## Структура папок

```
workplan/
├── README.md          # Этот файл (источник истины)
├── backlog/           # Ожидающие планы
│   └── RULES.md
├── coding/            # В процессе разработки
│   └── RULES.md
├── done/              # Завершённые планы (архив)
│   └── RULES.md
└── draft/             # Черновики, идеи и решения (без процесса смены статуса)
    └── RULES.md
```

Каждый `RULES.md` содержит правила и соглашения об именовании, специфичные для папки:

- `backlog/RULES.md` — Точка входа для новых планов, инструкции по созданию задач
- `coding/RULES.md` — Активная работа, правила переходов и прогресса
- `done/RULES.md` — Архив, критерии завершения
- `draft/RULES.md` — Банк идей, без процесса, без идентификатора задачи

## YAML Frontmatter

Каждый файл плана должен начинаться с блока YAML frontmatter на **строке 1** (без пустых строк перед открывающим `---`). GitHub отображает это как таблицу метаданных.

```yaml
---
plan: "Описательное название"
state: "backlog"
issue: ""
domain: "general"
backlog: "2026-01-15"
coding: ""
done: ""
---
```

**Поля frontmatter:**

| Поле | Описание | Значения |
|------|----------|----------|
| `plan` | Краткое описательное название | Свободный текст |
| `state` | Текущий статус (должен совпадать с префиксом имени файла) | `backlog`, `coding`, `done`, `draft` |
| `issue` | Идентификатор задачи (`iNNNN`) или пустое значение | `"i0060"`, `""` |
| `domain` | Функциональная область | `general` или специфичная для проекта |
| `backlog` | Дата создания плана | `"2026-01-15"`, `""` |
| `coding` | Дата начала работы | `"2026-01-20"`, `""` |
| `done` | Дата завершения | `"2026-02-01"`, `""` |

**Правила frontmatter:**
- Первый `---` должен быть строго на строке 1, без пустых строк перед ним
- Значение `state` должно совпадать с префиксом имени файла (в нижнем регистре)
- **issue** — `""`, если трекер задач настроен как «none»
- Когда трекер активен, **issue** содержит идентификатор: `"i0060"`
- Черновики не содержат полей `issue` и дат
- Поля дат фиксируют момент каждого перехода (`""`, если ещё не достигнут)

## Стандартный шаблон

### Обязательная терминология

| Термин | Использование | Пример |
|--------|---------------|--------|
| **Фаза** | Крупная веха реализации | Фаза 1: MVP, Фаза 2: Улучшения |
| **Шаг** | Конкретный пункт в чек-листе прогресса | `- [ ] Создать SQL-миграцию` |

### Порядок разделов

Frontmatter → Прогресс → Цель → Контекст → Реализация → Проверка → Риски

Необязательные разделы **опускаются**, а не оставляются пустыми.

### Шаблон

```markdown
---
plan: "Описательное название"
state: "backlog"
issue: ""
domain: "general"
backlog: "YYYY-MM-DD"
coding: ""
done: ""
---

## Прогресс

### Фаза 1: MVP
- [ ] Конкретный, проверяемый шаг
- [ ] Ещё один шаг

### Фаза 2: Улучшения *(если применимо)*
- [ ] Конкретный, проверяемый шаг

## Цель

Чего нужно достичь и почему (1–3 абзаца).

## Контекст *(необязательно)*

Текущее состояние, предпосылки.

## Реализация

### Фаза 1: MVP

Техническое описание реализации.

### Фаза 2: Улучшения *(необязательно)*

## Проверка *(необязательно)*

Шаги для подтверждения корректного выполнения плана.

## Риски *(необязательно)*

Только для сложных планов.
```

### Правила

1. **Прогресс всегда после frontmatter**, никогда не в конце
2. Шаги группируются по фазам (`### Фаза N: Название`)
3. Каждый шаг должен быть конкретным и проверяемым (не общим)
4. Техническая детализация в Реализации, краткое изложение в Прогрессе
5. Только «Фаза» и «Шаг», никогда «Этап»
6. Необязательные разделы опускаются, а не оставляются пустыми

## Процесс

### Создание плана

**С трекером задач:**

1. Сначала создайте задачу: `gh issue create` (GitHub) или `glab issue create` (GitLab)
2. Запишите номер задачи (например, #60)
3. Создайте файл в `backlog/BACKLOG-YYYY-MM-DD-iNNNN-description.md` (например, `BACKLOG-2026-01-15-i0060-user-auth-setup.md`)
4. Заполните поле `issue` в frontmatter идентификатором

**Без трекера задач:**

1. Создайте файл в `backlog/BACKLOG-YYYY-MM-DD-description.md`

### Начало работы

1. Переместите из `backlog/` в `coding/CODING-YYYY-MM-DD-...-description.md` (дата = сегодня, идентификатор не меняется)
2. Обновите frontmatter: `state: "coding"`, `coding: "YYYY-MM-DD"`

### Завершение

1. Переместите из `coding/` в `done/DONE-YYYY-MM-DD-...-description.md` (дата = сегодня)
2. Обновите frontmatter: `state: "done"`, `done: "YYYY-MM-DD"`

### Возврат в backlog

1. Переместите из `coding/` в `backlog/BACKLOG-YYYY-MM-DD-...-description.md`
2. Обновите frontmatter: `state: "backlog"`, `coding: ""`

## Перекрёстные ссылки

**С трекером задач:** планы ссылаются друг на друга по номеру задачи с помощью `#N`, который является постоянным и обеспечивает автоматическое связывание:

```markdown
**Зависимости:** #1, #2

Подробности см. в #3.
```

**Без трекера задач:** ссылайтесь на планы по описательному названию:

```markdown
**Зависимости:** user-auth-setup, api-rate-limiting
```

**Правило:** никогда не ссылайтесь на план по полному имени файла (оно меняется при каждом переходе).

## Черновики

Черновики хранятся в `draft/` с форматом `DRAFT-YYYY-MM-DD-description.md`. Они не следуют процессу BACKLOG→CODING→DONE и не имеют идентификатора задачи. Они служат банком идей: наброски планов, технические решения, исследовательские заметки. Когда черновик достаточно созревает, он продвигается в `backlog/` как формальный план.
